{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _raf = require('raf');\n\nvar _raf2 = _interopRequireDefault(_raf);\n\nvar _tween = require('./tween.js');\n\nvar _tween2 = _interopRequireDefault(_tween);\n\nvar _Loading = require('./Loading');\n\nvar _Loading2 = _interopRequireDefault(_Loading);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n/* eslint max-len: [0] */\n\n/**\n *\n * @param {number} value\n * @param {number} min\n * @param {number} max\n */\n\n\nfunction setScope(value, min, max) {\n  if (value < min) {\n    return min;\n  }\n\n  if (value > max) {\n    return max;\n  }\n\n  return value;\n}\n\nfunction getDistanceBetweenTouches(e) {\n  if (e.touches.length < 2) return 1;\n  var x1 = e.touches[0].clientX;\n  var y1 = e.touches[0].clientY;\n  var x2 = e.touches[1].clientX;\n  var y2 = e.touches[1].clientY;\n  var distance = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n  return distance;\n} // const msPerFrame = 1000 / 60;\n\n\nvar maxAnimateTime = 1000;\nvar minTapMoveValue = 5;\nvar maxTapTimeValue = 300;\n/**\n * 图片默认展示模式：宽度等于屏幕宽度，高度等比缩放；水平居中，垂直居中或者居顶（当高度大于屏幕高度时）\n * 图片实际尺寸： actualWith, actualHeight\n * 图片初始尺寸： originWidth, originHeight\n * 坐标位置：left, top\n * 放大倍数：zoom\n * 最大放大倍数：maxZoomNum\n * 坐标关系：-(maxZoomNum - 1) * originWidth / 2 < left < 0\n *         -(maxZoomNum - 1) * originHeight / 2 < top < 0\n * 尺寸关系：width = zoom * originWidth\n *         heigth = zoom * originHeight\n *\n * 放大点位置关系：\n * 初始点位置：oldPointLeft, oldPointTop\n * 放大后位置：newPointLeft, newPointTop\n * 对应关系： newPointLeft = zoom * oldPointLeft\n *          newPointTop = zoom * oldPointTop\n *\n * 坐标位置：-1*left = -1*startLeft + (newPointLeft - oldPointLeft) =-1*startLeft (zoom - 1) * oldPointLeft\n *         -1*top = -1*startTop + (newPointTop - oldPointTop) =-1*startLeft (zoom - 1) * oldPointTop\n * =>\n * left = startLeft + (1 - zoom) * oldPointLeft\n * top = startTop + (1 - zoom) * oldPointTop\n */\n\nvar ImageContainer = function (_PureComponent) {\n  _inherits(ImageContainer, _PureComponent);\n\n  function ImageContainer() {\n    _classCallCheck(this, ImageContainer);\n\n    var _this = _possibleConstructorReturn(this, (ImageContainer.__proto__ || Object.getPrototypeOf(ImageContainer)).call(this));\n\n    _this.state = {\n      width: 0,\n      height: 0,\n      scale: 1,\n      left: 0,\n      top: 0,\n      isLoaded: false\n    };\n\n    _this.onLoad = function () {\n      _this.actualWith = _this.img.width;\n      _this.actualHeight = _this.img.height;\n      var _this$props = _this.props,\n          screenHeight = _this$props.screenHeight,\n          screenWidth = _this$props.screenWidth;\n      var left = 0;\n      var top = 0;\n      _this.originWidth = screenWidth;\n      _this.originHeight = _this.actualHeight / _this.actualWith * screenWidth;\n      _this.originScale = 1;\n\n      if (_this.actualHeight / _this.actualWith < screenHeight / screenWidth) {\n        top = parseInt((screenHeight - _this.originHeight) / 2, 10);\n      }\n\n      _this.originTop = top;\n\n      _this.setState({\n        width: _this.originWidth,\n        height: _this.originHeight,\n        scale: 1,\n        left: left,\n        top: top,\n        isLoaded: true\n      });\n    };\n\n    _this.onError = function () {\n      _this.setState({\n        isLoaded: true\n      });\n    };\n\n    _this.loadImg = function (url) {\n      _this.img = new Image();\n      _this.img.src = url;\n      _this.img.onload = _this.onLoad;\n      _this.img.onerror = _this.onError;\n\n      _this.setState({\n        isLoaded: false\n      });\n    };\n\n    _this.unloadImg = function () {\n      delete _this.img.onerror;\n      delete _this.img.onload;\n      delete _this.img.src;\n      delete _this.img;\n    };\n\n    _this.handleTouchStart = function (event) {\n      console.info('handleTouchStart');\n      event.preventDefault();\n\n      if (_this.animationID) {\n        _raf2.default.cancel(_this.animationID);\n      }\n\n      switch (event.touches.length) {\n        case 1:\n          {\n            var targetEvent = event.touches[0];\n            _this.startX = targetEvent.clientX;\n            _this.startY = targetEvent.clientY;\n            _this.diffX = 0;\n            _this.diffY = 0;\n            _this.startLeft = _this.state.left;\n            _this.startTop = _this.state.top;\n            console.info('handleTouchStart this.startX = %s, this.startY = %s, this.startLeft = %s, this.startTop = %s', _this.startX, _this.startY, _this.startLeft, _this.startTop);\n            _this.onTouchStartTime = new Date().getTime();\n            _this.haveCallMoveFn = false;\n            break;\n          }\n\n        case 2:\n          {\n            // 两个手指\n            // 设置手双指模式\n            _this.isTwoFingerMode = true; // 计算两个手指中间点屏幕上的坐标\n\n            var middlePointClientLeft = Math.abs(Math.round((event.touches[0].clientX + event.touches[1].clientX) / 2));\n            var middlePointClientTop = Math.abs(Math.round((event.touches[0].clientY + event.touches[1].clientY) / 2)); // 保存图片初始位置和尺寸\n\n            _this.startLeft = _this.state.left;\n            _this.startTop = _this.state.top;\n            _this.startScale = _this.state.scale; // 计算手指中间点在图片上的位置（坐标值）\n\n            _this.oldPointLeft = middlePointClientLeft - _this.startLeft;\n            _this.oldPointTop = middlePointClientTop - _this.startTop;\n            _this._touchZoomDistanceStart = getDistanceBetweenTouches(event);\n            break;\n          }\n\n        default:\n          break;\n      }\n    };\n\n    _this.handleTouchMove = function (event) {\n      event.preventDefault();\n\n      switch (event.touches.length) {\n        case 1:\n          {\n            var targetEvent = event.touches[0];\n            var diffX = targetEvent.clientX - _this.startX;\n            var diffY = targetEvent.clientY - _this.startY;\n            _this.diffX = diffX;\n            _this.diffY = diffY;\n            console.info('handleTouchMove one diffX=%s, diffY=%s', diffX, diffY); // 判断是否为点击\n\n            if (Math.abs(diffX) < minTapMoveValue && Math.abs(diffY) < minTapMoveValue) {\n              return;\n            }\n\n            var _this$state = _this.state,\n                scale = _this$state.scale,\n                left = _this$state.left;\n            var width = scale * _this.originWidth;\n\n            if (Math.abs(diffX) > Math.abs(diffY)) {\n              // 水平移动\n              if (_this.state.scale === _this.originScale && Math.abs(diffX) > minTapMoveValue) {\n                _this.haveCallMoveFn = true;\n\n                _this.callHandleMove(diffX);\n\n                return;\n              }\n\n              console.info('handleMove one left=%s, this.startLeft=%s,this.originWidth=%s, width=%s', left, _this.startLeft, _this.originWidth, width);\n\n              if (diffX < 0 && _this.startLeft <= _this.originWidth - width) {\n                _this.haveCallMoveFn = true;\n\n                _this.callHandleMove(diffX);\n\n                return;\n              }\n\n              if (diffX > 0 && _this.startLeft >= 0) {\n                _this.haveCallMoveFn = true;\n\n                _this.callHandleMove(diffX);\n\n                return;\n              }\n            }\n\n            var screenHeight = _this.props.screenHeight;\n            var height = scale * _this.originHeight;\n            var newTop = (screenHeight - height) / 2;\n            var newLeft = _this.startLeft + diffX;\n\n            if (height > screenHeight || _this.state.scale === _this.originScale) {\n              newTop = _this.startTop + diffY;\n            }\n\n            console.info('handleTouchMove one newLeft=%s, newTop=%s', newLeft, newTop);\n\n            _this.setState({\n              left: newLeft,\n              top: newTop\n            });\n\n            break;\n          }\n\n        case 2:\n          {\n            // 两个手指\n            _this._touchZoomDistanceEnd = getDistanceBetweenTouches(event);\n            var zoom = Math.sqrt(_this._touchZoomDistanceEnd / _this._touchZoomDistanceStart);\n\n            var _scale = zoom * _this.startScale;\n\n            _this.setState(function () {\n              var left = _this.startLeft + (1 - zoom) * _this.oldPointLeft;\n              var top = _this.startTop + (1 - zoom) * _this.oldPointTop;\n              console.info('zoom = %s, left = %s, top = %s, scale', zoom, left, top, _scale);\n              return {\n                left: left,\n                top: top,\n                scale: _scale\n              };\n            });\n\n            break;\n          }\n\n        default:\n          break;\n      }\n    };\n\n    _this.handleTouchEnd = function (event) {\n      console.info('handleTouchEnd', event.touches.length);\n      event.preventDefault();\n\n      if (_this.isTwoFingerMode) {\n        // 双指操作结束\n        var touchLen = event.touches.length;\n        _this.isTwoFingerMode = false;\n\n        if (touchLen === 1) {\n          var targetEvent = event.touches[0];\n          _this.startX = targetEvent.clientX;\n          _this.startY = targetEvent.clientY;\n          _this.diffX = 0;\n          _this.diffY = 0;\n        }\n\n        _this.setState(function (prevState, props) {\n          var scale = setScope(prevState.scale, 1, props.maxZoomNum);\n          var width = scale * _this.originWidth;\n          var height = scale * _this.originHeight;\n          var zoom = scale / _this.startScale;\n          var left = setScope(_this.startLeft + (1 - zoom) * _this.oldPointLeft, _this.originWidth - width, 0);\n          var top = void 0;\n\n          if (height > props.screenHeight) {\n            top = setScope(_this.startTop + (1 - zoom) * _this.oldPointTop, props.screenHeight - height, 0);\n          } else {\n            top = (props.screenHeight - height) / 2;\n          }\n\n          if (touchLen === 1) {\n            _this.startLeft = left;\n            _this.startTop = top;\n            _this.startScale = scale;\n            console.info('this.startX = %s, this.startY = %s, this.startLeft = %s, this.startTop = %s', _this.startX, _this.startY, _this.startLeft, _this.startTop);\n          }\n\n          console.info('zoom = %s, left = %s, top = %s, width=%s, height= %s', zoom, left, top, width, height);\n          return {\n            left: left,\n            top: top,\n            scale: scale\n          };\n        });\n      } else {\n        // 单指结束（ontouchend）\n        var diffTime = new Date().getTime() - _this.onTouchStartTime;\n\n        var diffX = _this.diffX,\n            diffY = _this.diffY;\n        console.info('handleTouchEnd one diffTime = %s, diffX = %s, diffy = %s', diffTime, diffX, diffY); // 判断为点击则关闭图片浏览组件\n\n        if (diffTime < maxTapTimeValue && Math.abs(diffX) < minTapMoveValue && Math.abs(diffY) < minTapMoveValue) {\n          _this.context.onClose();\n\n          return;\n        } // 水平移动\n\n\n        if (_this.haveCallMoveFn) {\n          var isChangeImage = _this.callHandleEnd(diffY < 30);\n\n          if (isChangeImage) {\n            // 如果切换图片则重置当前图片状态\n            setTimeout(function () {\n              _this.setState({\n                scale: _this.originScale,\n                left: 0,\n                top: _this.originTop\n              });\n            }, maxAnimateTime / 3);\n            return;\n          }\n        } // TODO 下拉移动距离超过屏幕高度的 1/3 则关闭\n        // console.info(Math.abs(diffY) > (this.props.screenHeight / 2), this.startTop, this.originTop);\n        // if (Math.abs(diffX) < Math.abs(diffY) && Math.abs(diffY) > (this.props.screenHeight / 3) && this.startTop === this.originTop) {\n        //   this.context.onClose();\n        //   return;\n        // }\n\n\n        var x = void 0;\n        var y = void 0;\n        var scale = _this.state.scale; // const width = scale * this.originWidth;\n\n        var height = scale * _this.originHeight; // 使用相同速度算法\n\n        x = diffX * maxAnimateTime / diffTime + _this.startLeft;\n        y = diffY * maxAnimateTime / diffTime + _this.startTop;\n\n        if (_this.state.scale === _this.originScale) {\n          x = 0;\n\n          if (height > _this.props.screenHeight) {\n            y = setScope(y, _this.props.screenHeight - height, 0);\n          } else {\n            y = _this.originTop;\n          }\n        } // x = setScope(x, this.originWidth - width, 0);\n        // if (height > this.props.screenHeight) {\n        // y = setScope(y, this.props.screenHeight - height, 0);\n        // } else {\n        //   y = this.state.top;\n        // }\n\n\n        _this.animateStartValue = {\n          x: _this.state.left,\n          y: _this.state.top\n        };\n        _this.animateFinalValue = {\n          x: x,\n          y: y\n        };\n        _this.animateStartTime = Date.now();\n\n        _this.startAnimate();\n      }\n    };\n\n    _this.startAnimate = function () {\n      _this.animationID = (0, _raf2.default)(function () {\n        // calculate current time\n        var curTime = Date.now() - _this.animateStartTime;\n\n        var left = void 0;\n        var top = void 0; // animate complete\n\n        if (curTime > maxAnimateTime) {\n          _this.setState(function (prevState, props) {\n            var width = prevState.scale * _this.originWidth;\n            var height = prevState.scale * _this.originHeight;\n            left = setScope(prevState.left, _this.originWidth - width, 0);\n\n            if (height > props.screenHeight) {\n              top = setScope(prevState.top, props.screenHeight - height, 0);\n            } else {\n              top = (props.screenHeight - height) / 2;\n            }\n\n            console.info('end animate left= %s, top = %s', left, top);\n            return {\n              left: left,\n              top: top\n            };\n          });\n        } else {\n          left = _tween2.default.easeOutQuart(curTime, _this.animateStartValue.x, _this.animateFinalValue.x, maxAnimateTime);\n          top = _tween2.default.easeOutQuart(curTime, _this.animateStartValue.y, _this.animateFinalValue.y, maxAnimateTime);\n          console.info('startAnimate left= %s, top = %s, curTime = %s', left, top, curTime);\n\n          _this.setState({\n            left: left,\n            top: top\n          });\n\n          _this.startAnimate();\n        }\n      });\n    };\n\n    _this.callHandleMove = function (diffX) {\n      if (!_this.isCalledHandleStart) {\n        _this.isCalledHandleStart = true;\n\n        if (_this.props.handleStart) {\n          _this.props.handleStart();\n        }\n      }\n\n      _this.props.handleMove(diffX);\n    };\n\n    _this.callHandleEnd = function (isAllowChange) {\n      if (_this.isCalledHandleStart) {\n        _this.isCalledHandleStart = false;\n\n        if (_this.props.handleEnd) {\n          return _this.props.handleEnd(isAllowChange);\n        }\n      }\n    };\n\n    _this.actualHeight = 0; // 图片实际高度\n\n    _this.actualWith = 0; // 图片实际宽度\n\n    _this.originHeight = 0; // 图片默认展示模式下高度\n\n    _this.originWidth = 0; // 图片默认展示模式下宽度\n\n    _this.originScale = 1; // 图片初始缩放比例\n\n    _this.startLeft = 0; // 开始触摸操作时的 left 值\n\n    _this.startTop = 0; // 开始触摸操作时的 top 值\n\n    _this.startScale = 1; // 开始缩放操作时的 scale 值\n\n    _this.onTouchStartTime = 0; // 单指触摸开始时间\n\n    _this.isTwoFingerMode = false; // 是否为双指模式\n\n    _this.oldPointLeft = 0; // 计算手指中间点在图片上的位置（坐标值）\n\n    _this.oldPointTop = 0; // 计算手指中间点在图片上的位置（坐标值）\n\n    _this._touchZoomDistanceStart = 0; // 用于记录双指距离\n\n    _this.haveCallMoveFn = false;\n    _this.diffX = 0; // 记录最后 move 事件 移动距离\n\n    _this.diffY = 0; // 记录最后 move 事件 移动距离\n\n    _this.animationID = 0;\n    _this.animateStartTime = 0;\n    _this.animateStartValue = {\n      x: 0,\n      y: 0\n    };\n    _this.animateFinalValue = {\n      x: 0,\n      y: 0\n    };\n    return _this;\n  }\n\n  _createClass(ImageContainer, [{\n    key: 'componentWillMount',\n    value: function componentWillMount() {\n      this.loadImg(this.props.src);\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      this.unloadImg();\n\n      if (this.animationID) {\n        _raf2.default.cancel(this.animationID);\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _props = this.props,\n          screenWidth = _props.screenWidth,\n          screenHeight = _props.screenHeight,\n          src = _props.src,\n          divLeft = _props.left;\n      var _state = this.state,\n          isLoaded = _state.isLoaded,\n          left = _state.left,\n          top = _state.top,\n          scale = _state.scale,\n          width = _state.width,\n          height = _state.height;\n      var ImageStyle = {\n        width: width,\n        height: height\n      };\n      var translate = 'translate3d(' + left + 'px, ' + top + 'px, 0) scale(' + scale + ')';\n      ImageStyle.WebkitTransform = translate;\n      ImageStyle.transform = translate;\n      var defaultStyle = {\n        left: divLeft,\n        width: screenWidth,\n        height: screenHeight\n      }; // console.info('ImageContainer render');\n\n      return _react2.default.createElement('div', {\n        className: 'viewer-image-container',\n        onTouchStart: this.handleTouchStart,\n        onTouchMove: this.handleTouchMove,\n        onTouchEnd: this.handleTouchEnd,\n        style: defaultStyle\n      }, isLoaded ? _react2.default.createElement('img', {\n        src: src,\n        style: ImageStyle,\n        alt: ''\n      }) : _react2.default.createElement(_Loading2.default, null));\n    }\n  }]);\n\n  return ImageContainer;\n}(_react.PureComponent);\n\nImageContainer.propTypes = {\n  maxZoomNum: _propTypes2.default.number.isRequired,\n  handleStart: _propTypes2.default.func.isRequired,\n  handleMove: _propTypes2.default.func.isRequired,\n  handleEnd: _propTypes2.default.func.isRequired\n};\nImageContainer.contextTypes = {\n  onClose: _propTypes2.default.func\n};\nexports.default = ImageContainer;","map":{"version":3,"sources":["D:/myCompany/zhongdianqiche/a/node_modules/react-wx-images-viewer/dist/components/ImageContainer.js"],"names":["Object","defineProperty","exports","value","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_react","require","_react2","_interopRequireDefault","_propTypes","_propTypes2","_raf","_raf2","_tween","_tween2","_Loading","_Loading2","obj","__esModule","default","_classCallCheck","instance","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","setScope","min","max","getDistanceBetweenTouches","e","touches","x1","clientX","y1","clientY","x2","y2","distance","Math","sqrt","pow","maxAnimateTime","minTapMoveValue","maxTapTimeValue","ImageContainer","_PureComponent","_this","getPrototypeOf","state","width","height","scale","left","top","isLoaded","onLoad","actualWith","img","actualHeight","_this$props","screenHeight","screenWidth","originWidth","originHeight","originScale","parseInt","originTop","setState","onError","loadImg","url","Image","src","onload","onerror","unloadImg","handleTouchStart","event","console","info","preventDefault","animationID","cancel","targetEvent","startX","startY","diffX","diffY","startLeft","startTop","onTouchStartTime","Date","getTime","haveCallMoveFn","isTwoFingerMode","middlePointClientLeft","abs","round","middlePointClientTop","startScale","oldPointLeft","oldPointTop","_touchZoomDistanceStart","handleTouchMove","_this$state","callHandleMove","newTop","newLeft","_touchZoomDistanceEnd","zoom","_scale","handleTouchEnd","touchLen","prevState","maxZoomNum","diffTime","context","onClose","isChangeImage","callHandleEnd","setTimeout","x","y","animateStartValue","animateFinalValue","animateStartTime","now","startAnimate","curTime","easeOutQuart","isCalledHandleStart","handleStart","handleMove","isAllowChange","handleEnd","componentWillMount","componentWillUnmount","render","_props","divLeft","_state","ImageStyle","translate","WebkitTransform","transform","defaultStyle","createElement","className","onTouchStart","onTouchMove","onTouchEnd","style","alt","PureComponent","propTypes","number","isRequired","func","contextTypes"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _raf = require('raf');\n\nvar _raf2 = _interopRequireDefault(_raf);\n\nvar _tween = require('./tween.js');\n\nvar _tween2 = _interopRequireDefault(_tween);\n\nvar _Loading = require('./Loading');\n\nvar _Loading2 = _interopRequireDefault(_Loading);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /* eslint max-len: [0] */\n\n/**\n *\n * @param {number} value\n * @param {number} min\n * @param {number} max\n */\nfunction setScope(value, min, max) {\n  if (value < min) {\n    return min;\n  }\n  if (value > max) {\n    return max;\n  }\n  return value;\n}\n\nfunction getDistanceBetweenTouches(e) {\n  if (e.touches.length < 2) return 1;\n  var x1 = e.touches[0].clientX;\n  var y1 = e.touches[0].clientY;\n  var x2 = e.touches[1].clientX;\n  var y2 = e.touches[1].clientY;\n  var distance = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n  return distance;\n}\n\n// const msPerFrame = 1000 / 60;\nvar maxAnimateTime = 1000;\nvar minTapMoveValue = 5;\nvar maxTapTimeValue = 300;\n\n/**\n * 图片默认展示模式：宽度等于屏幕宽度，高度等比缩放；水平居中，垂直居中或者居顶（当高度大于屏幕高度时）\n * 图片实际尺寸： actualWith, actualHeight\n * 图片初始尺寸： originWidth, originHeight\n * 坐标位置：left, top\n * 放大倍数：zoom\n * 最大放大倍数：maxZoomNum\n * 坐标关系：-(maxZoomNum - 1) * originWidth / 2 < left < 0\n *         -(maxZoomNum - 1) * originHeight / 2 < top < 0\n * 尺寸关系：width = zoom * originWidth\n *         heigth = zoom * originHeight\n *\n * 放大点位置关系：\n * 初始点位置：oldPointLeft, oldPointTop\n * 放大后位置：newPointLeft, newPointTop\n * 对应关系： newPointLeft = zoom * oldPointLeft\n *          newPointTop = zoom * oldPointTop\n *\n * 坐标位置：-1*left = -1*startLeft + (newPointLeft - oldPointLeft) =-1*startLeft (zoom - 1) * oldPointLeft\n *         -1*top = -1*startTop + (newPointTop - oldPointTop) =-1*startLeft (zoom - 1) * oldPointTop\n * =>\n * left = startLeft + (1 - zoom) * oldPointLeft\n * top = startTop + (1 - zoom) * oldPointTop\n */\n\nvar ImageContainer = function (_PureComponent) {\n  _inherits(ImageContainer, _PureComponent);\n\n  function ImageContainer() {\n    _classCallCheck(this, ImageContainer);\n\n    var _this = _possibleConstructorReturn(this, (ImageContainer.__proto__ || Object.getPrototypeOf(ImageContainer)).call(this));\n\n    _this.state = {\n      width: 0,\n      height: 0,\n      scale: 1,\n      left: 0,\n      top: 0,\n      isLoaded: false\n    };\n\n    _this.onLoad = function () {\n      _this.actualWith = _this.img.width;\n      _this.actualHeight = _this.img.height;\n\n      var _this$props = _this.props,\n          screenHeight = _this$props.screenHeight,\n          screenWidth = _this$props.screenWidth;\n\n\n      var left = 0;\n      var top = 0;\n\n      _this.originWidth = screenWidth;\n      _this.originHeight = _this.actualHeight / _this.actualWith * screenWidth;\n      _this.originScale = 1;\n\n      if (_this.actualHeight / _this.actualWith < screenHeight / screenWidth) {\n        top = parseInt((screenHeight - _this.originHeight) / 2, 10);\n      }\n      _this.originTop = top;\n\n      _this.setState({\n        width: _this.originWidth,\n        height: _this.originHeight,\n        scale: 1,\n        left: left,\n        top: top,\n        isLoaded: true\n      });\n    };\n\n    _this.onError = function () {\n      _this.setState({\n        isLoaded: true\n      });\n    };\n\n    _this.loadImg = function (url) {\n      _this.img = new Image();\n      _this.img.src = url;\n      _this.img.onload = _this.onLoad;\n      _this.img.onerror = _this.onError;\n\n      _this.setState({\n        isLoaded: false\n      });\n    };\n\n    _this.unloadImg = function () {\n      delete _this.img.onerror;\n      delete _this.img.onload;\n      delete _this.img.src;\n      delete _this.img;\n    };\n\n    _this.handleTouchStart = function (event) {\n      console.info('handleTouchStart');\n      event.preventDefault();\n      if (_this.animationID) {\n        _raf2.default.cancel(_this.animationID);\n      }\n      switch (event.touches.length) {\n        case 1:\n          {\n            var targetEvent = event.touches[0];\n            _this.startX = targetEvent.clientX;\n            _this.startY = targetEvent.clientY;\n            _this.diffX = 0;\n            _this.diffY = 0;\n\n            _this.startLeft = _this.state.left;\n            _this.startTop = _this.state.top;\n\n            console.info('handleTouchStart this.startX = %s, this.startY = %s, this.startLeft = %s, this.startTop = %s', _this.startX, _this.startY, _this.startLeft, _this.startTop);\n\n            _this.onTouchStartTime = new Date().getTime();\n            _this.haveCallMoveFn = false;\n            break;\n          }\n        case 2:\n          {\n            // 两个手指\n            // 设置手双指模式\n            _this.isTwoFingerMode = true;\n\n            // 计算两个手指中间点屏幕上的坐标\n            var middlePointClientLeft = Math.abs(Math.round((event.touches[0].clientX + event.touches[1].clientX) / 2));\n            var middlePointClientTop = Math.abs(Math.round((event.touches[0].clientY + event.touches[1].clientY) / 2));\n\n            // 保存图片初始位置和尺寸\n            _this.startLeft = _this.state.left;\n            _this.startTop = _this.state.top;\n            _this.startScale = _this.state.scale;\n\n            // 计算手指中间点在图片上的位置（坐标值）\n            _this.oldPointLeft = middlePointClientLeft - _this.startLeft;\n            _this.oldPointTop = middlePointClientTop - _this.startTop;\n\n            _this._touchZoomDistanceStart = getDistanceBetweenTouches(event);\n            break;\n          }\n        default:\n          break;\n      }\n    };\n\n    _this.handleTouchMove = function (event) {\n      event.preventDefault();\n\n      switch (event.touches.length) {\n        case 1:\n          {\n            var targetEvent = event.touches[0];\n            var diffX = targetEvent.clientX - _this.startX;\n            var diffY = targetEvent.clientY - _this.startY;\n\n            _this.diffX = diffX;\n            _this.diffY = diffY;\n            console.info('handleTouchMove one diffX=%s, diffY=%s', diffX, diffY);\n            // 判断是否为点击\n            if (Math.abs(diffX) < minTapMoveValue && Math.abs(diffY) < minTapMoveValue) {\n              return;\n            }\n\n            var _this$state = _this.state,\n                scale = _this$state.scale,\n                left = _this$state.left;\n\n            var width = scale * _this.originWidth;\n            if (Math.abs(diffX) > Math.abs(diffY)) {\n              // 水平移动\n              if (_this.state.scale === _this.originScale && Math.abs(diffX) > minTapMoveValue) {\n                _this.haveCallMoveFn = true;\n                _this.callHandleMove(diffX);\n                return;\n              }\n\n              console.info('handleMove one left=%s, this.startLeft=%s,this.originWidth=%s, width=%s', left, _this.startLeft, _this.originWidth, width);\n              if (diffX < 0 && _this.startLeft <= _this.originWidth - width) {\n                _this.haveCallMoveFn = true;\n                _this.callHandleMove(diffX);\n                return;\n              }\n\n              if (diffX > 0 && _this.startLeft >= 0) {\n                _this.haveCallMoveFn = true;\n                _this.callHandleMove(diffX);\n                return;\n              }\n            }\n\n            var screenHeight = _this.props.screenHeight;\n\n            var height = scale * _this.originHeight;\n            var newTop = (screenHeight - height) / 2;\n            var newLeft = _this.startLeft + diffX;\n\n            if (height > screenHeight || _this.state.scale === _this.originScale) {\n              newTop = _this.startTop + diffY;\n            }\n            console.info('handleTouchMove one newLeft=%s, newTop=%s', newLeft, newTop);\n            _this.setState({\n              left: newLeft,\n              top: newTop\n            });\n\n            break;\n          }\n        case 2:\n          {\n            // 两个手指\n            _this._touchZoomDistanceEnd = getDistanceBetweenTouches(event);\n\n            var zoom = Math.sqrt(_this._touchZoomDistanceEnd / _this._touchZoomDistanceStart);\n            var _scale = zoom * _this.startScale;\n\n            _this.setState(function () {\n              var left = _this.startLeft + (1 - zoom) * _this.oldPointLeft;\n              var top = _this.startTop + (1 - zoom) * _this.oldPointTop;\n\n              console.info('zoom = %s, left = %s, top = %s, scale', zoom, left, top, _scale);\n              return {\n                left: left,\n                top: top,\n                scale: _scale\n              };\n            });\n            break;\n          }\n        default:\n          break;\n      }\n    };\n\n    _this.handleTouchEnd = function (event) {\n      console.info('handleTouchEnd', event.touches.length);\n      event.preventDefault();\n\n      if (_this.isTwoFingerMode) {\n        // 双指操作结束\n        var touchLen = event.touches.length;\n        _this.isTwoFingerMode = false;\n\n        if (touchLen === 1) {\n          var targetEvent = event.touches[0];\n          _this.startX = targetEvent.clientX;\n          _this.startY = targetEvent.clientY;\n          _this.diffX = 0;\n          _this.diffY = 0;\n        }\n\n        _this.setState(function (prevState, props) {\n          var scale = setScope(prevState.scale, 1, props.maxZoomNum);\n          var width = scale * _this.originWidth;\n          var height = scale * _this.originHeight;\n          var zoom = scale / _this.startScale;\n          var left = setScope(_this.startLeft + (1 - zoom) * _this.oldPointLeft, _this.originWidth - width, 0);\n\n          var top = void 0;\n          if (height > props.screenHeight) {\n            top = setScope(_this.startTop + (1 - zoom) * _this.oldPointTop, props.screenHeight - height, 0);\n          } else {\n            top = (props.screenHeight - height) / 2;\n          }\n\n          if (touchLen === 1) {\n            _this.startLeft = left;\n            _this.startTop = top;\n            _this.startScale = scale;\n            console.info('this.startX = %s, this.startY = %s, this.startLeft = %s, this.startTop = %s', _this.startX, _this.startY, _this.startLeft, _this.startTop);\n          }\n\n          console.info('zoom = %s, left = %s, top = %s, width=%s, height= %s', zoom, left, top, width, height);\n          return {\n            left: left,\n            top: top,\n            scale: scale\n          };\n        });\n      } else {\n        // 单指结束（ontouchend）\n        var diffTime = new Date().getTime() - _this.onTouchStartTime;\n        var diffX = _this.diffX,\n            diffY = _this.diffY;\n\n\n        console.info('handleTouchEnd one diffTime = %s, diffX = %s, diffy = %s', diffTime, diffX, diffY);\n        // 判断为点击则关闭图片浏览组件\n        if (diffTime < maxTapTimeValue && Math.abs(diffX) < minTapMoveValue && Math.abs(diffY) < minTapMoveValue) {\n          _this.context.onClose();\n          return;\n        }\n\n        // 水平移动\n        if (_this.haveCallMoveFn) {\n          var isChangeImage = _this.callHandleEnd(diffY < 30);\n          if (isChangeImage) {\n            // 如果切换图片则重置当前图片状态\n            setTimeout(function () {\n              _this.setState({\n                scale: _this.originScale,\n                left: 0,\n                top: _this.originTop\n              });\n            }, maxAnimateTime / 3);\n            return;\n          }\n        }\n        // TODO 下拉移动距离超过屏幕高度的 1/3 则关闭\n        // console.info(Math.abs(diffY) > (this.props.screenHeight / 2), this.startTop, this.originTop);\n        // if (Math.abs(diffX) < Math.abs(diffY) && Math.abs(diffY) > (this.props.screenHeight / 3) && this.startTop === this.originTop) {\n        //   this.context.onClose();\n        //   return;\n        // }\n\n        var x = void 0;\n        var y = void 0;\n        var scale = _this.state.scale;\n        // const width = scale * this.originWidth;\n\n        var height = scale * _this.originHeight;\n\n        // 使用相同速度算法\n        x = diffX * maxAnimateTime / diffTime + _this.startLeft;\n        y = diffY * maxAnimateTime / diffTime + _this.startTop;\n\n        if (_this.state.scale === _this.originScale) {\n          x = 0;\n          if (height > _this.props.screenHeight) {\n            y = setScope(y, _this.props.screenHeight - height, 0);\n          } else {\n            y = _this.originTop;\n          }\n        }\n\n        // x = setScope(x, this.originWidth - width, 0);\n\n        // if (height > this.props.screenHeight) {\n        // y = setScope(y, this.props.screenHeight - height, 0);\n        // } else {\n        //   y = this.state.top;\n        // }\n\n        _this.animateStartValue = {\n          x: _this.state.left,\n          y: _this.state.top\n        };\n        _this.animateFinalValue = {\n          x: x,\n          y: y\n        };\n        _this.animateStartTime = Date.now();\n        _this.startAnimate();\n      }\n    };\n\n    _this.startAnimate = function () {\n      _this.animationID = (0, _raf2.default)(function () {\n        // calculate current time\n        var curTime = Date.now() - _this.animateStartTime;\n        var left = void 0;\n        var top = void 0;\n\n        // animate complete\n        if (curTime > maxAnimateTime) {\n          _this.setState(function (prevState, props) {\n            var width = prevState.scale * _this.originWidth;\n            var height = prevState.scale * _this.originHeight;\n            left = setScope(prevState.left, _this.originWidth - width, 0);\n\n            if (height > props.screenHeight) {\n              top = setScope(prevState.top, props.screenHeight - height, 0);\n            } else {\n              top = (props.screenHeight - height) / 2;\n            }\n            console.info('end animate left= %s, top = %s', left, top);\n            return {\n              left: left,\n              top: top\n            };\n          });\n        } else {\n          left = _tween2.default.easeOutQuart(curTime, _this.animateStartValue.x, _this.animateFinalValue.x, maxAnimateTime);\n          top = _tween2.default.easeOutQuart(curTime, _this.animateStartValue.y, _this.animateFinalValue.y, maxAnimateTime);\n\n          console.info('startAnimate left= %s, top = %s, curTime = %s', left, top, curTime);\n          _this.setState({\n            left: left,\n            top: top\n          });\n          _this.startAnimate();\n        }\n      });\n    };\n\n    _this.callHandleMove = function (diffX) {\n      if (!_this.isCalledHandleStart) {\n        _this.isCalledHandleStart = true;\n        if (_this.props.handleStart) {\n          _this.props.handleStart();\n        }\n      }\n      _this.props.handleMove(diffX);\n    };\n\n    _this.callHandleEnd = function (isAllowChange) {\n      if (_this.isCalledHandleStart) {\n        _this.isCalledHandleStart = false;\n        if (_this.props.handleEnd) {\n          return _this.props.handleEnd(isAllowChange);\n        }\n      }\n    };\n\n    _this.actualHeight = 0; // 图片实际高度\n    _this.actualWith = 0; // 图片实际宽度\n\n    _this.originHeight = 0; // 图片默认展示模式下高度\n    _this.originWidth = 0; // 图片默认展示模式下宽度\n    _this.originScale = 1; // 图片初始缩放比例\n\n    _this.startLeft = 0; // 开始触摸操作时的 left 值\n    _this.startTop = 0; // 开始触摸操作时的 top 值\n    _this.startScale = 1; // 开始缩放操作时的 scale 值\n\n    _this.onTouchStartTime = 0; // 单指触摸开始时间\n\n    _this.isTwoFingerMode = false; // 是否为双指模式\n    _this.oldPointLeft = 0; // 计算手指中间点在图片上的位置（坐标值）\n    _this.oldPointTop = 0; // 计算手指中间点在图片上的位置（坐标值）\n    _this._touchZoomDistanceStart = 0; // 用于记录双指距离\n    _this.haveCallMoveFn = false;\n\n    _this.diffX = 0; // 记录最后 move 事件 移动距离\n    _this.diffY = 0; // 记录最后 move 事件 移动距离\n\n    _this.animationID = 0;\n    _this.animateStartTime = 0;\n    _this.animateStartValue = {\n      x: 0,\n      y: 0\n    };\n    _this.animateFinalValue = {\n      x: 0,\n      y: 0\n    };\n    return _this;\n  }\n\n  _createClass(ImageContainer, [{\n    key: 'componentWillMount',\n    value: function componentWillMount() {\n      this.loadImg(this.props.src);\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      this.unloadImg();\n      if (this.animationID) {\n        _raf2.default.cancel(this.animationID);\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _props = this.props,\n          screenWidth = _props.screenWidth,\n          screenHeight = _props.screenHeight,\n          src = _props.src,\n          divLeft = _props.left;\n      var _state = this.state,\n          isLoaded = _state.isLoaded,\n          left = _state.left,\n          top = _state.top,\n          scale = _state.scale,\n          width = _state.width,\n          height = _state.height;\n\n\n      var ImageStyle = {\n        width: width,\n        height: height\n      };\n\n      var translate = 'translate3d(' + left + 'px, ' + top + 'px, 0) scale(' + scale + ')';\n      ImageStyle.WebkitTransform = translate;\n      ImageStyle.transform = translate;\n\n      var defaultStyle = {\n        left: divLeft,\n        width: screenWidth,\n        height: screenHeight\n      };\n      // console.info('ImageContainer render');\n      return _react2.default.createElement(\n        'div',\n        {\n          className: 'viewer-image-container',\n          onTouchStart: this.handleTouchStart,\n          onTouchMove: this.handleTouchMove,\n          onTouchEnd: this.handleTouchEnd,\n          style: defaultStyle\n        },\n        isLoaded ? _react2.default.createElement('img', { src: src, style: ImageStyle, alt: '' }) : _react2.default.createElement(_Loading2.default, null)\n      );\n    }\n  }]);\n\n  return ImageContainer;\n}(_react.PureComponent);\n\nImageContainer.propTypes = {\n  maxZoomNum: _propTypes2.default.number.isRequired,\n  handleStart: _propTypes2.default.func.isRequired,\n  handleMove: _propTypes2.default.func.isRequired,\n  handleEnd: _propTypes2.default.func.isRequired\n};\nImageContainer.contextTypes = {\n  onClose: _propTypes2.default.func\n};\nexports.default = ImageContainer;"]},"metadata":{},"sourceType":"script"}