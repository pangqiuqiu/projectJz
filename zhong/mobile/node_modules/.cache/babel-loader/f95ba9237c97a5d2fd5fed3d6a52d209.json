{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\myCompany\\\\zhongdianqiche\\\\a\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _toConsumableArray from\"D:\\\\myCompany\\\\zhongdianqiche\\\\a\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"D:\\\\myCompany\\\\zhongdianqiche\\\\a\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"D:\\\\myCompany\\\\zhongdianqiche\\\\a\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"D:\\\\myCompany\\\\zhongdianqiche\\\\a\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"D:\\\\myCompany\\\\zhongdianqiche\\\\a\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"D:\\\\myCompany\\\\zhongdianqiche\\\\a\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from'react';// 组件\nimport DownloadApp from'../../../components/DownloadApp';// axios\nimport axios from'../../../untils/axios';import styles from'./index.module.css';var Home=/*#__PURE__*/function(_React$Component){_inherits(Home,_React$Component);var _super=_createSuper(Home);function Home(props){var _this;_classCallCheck(this,Home);_this=_super.call(this,props);_this.handle=function(type,id){if(type==='重点号资讯'){_this.props.history.push(\"/infor_details?id=\".concat(id));}else{_this.props.history.push(\"/video_details?id=\".concat(id));}};_this.bindHandleScroll=function(){var winHeight=Math.ceil(window.scrollY+window.innerHeight);return winHeight>=document.body.scrollHeight-50;// 距离底部为50时候发送请求\n};_this.state={list:[],page:0,isLoadingMore:false};return _this;}_createClass(Home,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;// 获取首页列表数据\nthis.getHomeList();// 监听滚动事件\nvar wrapper=this.refs.wrapper;var loadMoreDataFn=this.loadMoreDataFn;var that=this;var timeCount;function callback(){var top=wrapper.getBoundingClientRect().top;// 加载更多距离顶部的距离\nvar windowHeight=window.screen.height;// 屏幕可视区域的高度\nif(top&&top<windowHeight){// 当 wrapper 已经被滚动到页面可视范围之内触发\nloadMoreDataFn(that);}}window.addEventListener('scroll',function(){if(_this2.state.isLoadingMore)return;if(timeCount){clearTimeout(timeCount);}timeCount=setTimeout(callback,500);},false);}// 加载更多事件\n},{key:\"loadMoreDataFn\",value:function(){var _loadMoreDataFn=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(that){var _yield$axios$post,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return that.setState({page:that.state.page+1});case 2:_context.next=4;return axios.post('/keyN/home',{pageNo:that.state.page,pageSize:14});case 4:_yield$axios$post=_context.sent;res=_yield$axios$post.data;that.setState({list:[].concat(_toConsumableArray(that.state.list),_toConsumableArray(res))});case 7:case\"end\":return _context.stop();}}},_callee);}));function loadMoreDataFn(_x){return _loadMoreDataFn.apply(this,arguments);}return loadMoreDataFn;}()// 获取列表数据\n},{key:\"getHomeList\",value:function(){var _getHomeList=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$axios$post2,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.post('/keyN/home',{pageNo:this.state.page,pageSize:14});case 2:_yield$axios$post2=_context2.sent;res=_yield$axios$post2.data;this.setState({list:res});case 5:case\"end\":return _context2.stop();}}},_callee2,this);}));function getHomeList(){return _getHomeList.apply(this,arguments);}return getHomeList;}()// 跳转\n},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/React.createElement(\"div\",{style:{paddingTop:'70px',paddingBottom:'50px'}},/*#__PURE__*/React.createElement(DownloadApp,null),/*#__PURE__*/React.createElement(\"ul\",{className:styles.inforList},this.state.list.map(function(item){return/*#__PURE__*/React.createElement(\"li\",{style:{backgroundColor:'#fff'},onClick:function onClick(){_this3.handle(item.type,item.id);},className:styles.inforList_item,key:item.id},/*#__PURE__*/React.createElement(\"div\",{style:{borderRadius:'5px 5px 0 0',overflow:'hidden'}},/*#__PURE__*/React.createElement(\"img\",{alt:\"\",style:{height:'100%'},src:item.object.coverPic})),/*#__PURE__*/React.createElement(\"h3\",{className:styles.title,style:{minHeight:'48.8px',overflow:'hidden'}},item.object.title),/*#__PURE__*/React.createElement(\"div\",{className:styles.user},/*#__PURE__*/React.createElement(\"img\",{style:{width:'25px',height:'25px',marginRight:'10px',borderRadius:'50%'},alt:\"\",src:item.key.headPic}),/*#__PURE__*/React.createElement(\"span\",{style:{fontSize:'12px',display:'inlineBlock',width:'80px'}},item.key.name),/*#__PURE__*/React.createElement(\"img\",{alt:\"\",style:{width:'15px',height:'15px',verticalAlign:'top'},src:require('../../../assets/home/dianzan@2x.png')})));})),/*#__PURE__*/React.createElement(\"div\",{className:styles.loadMore,ref:\"wrapper\",onClick:this.loadMoreDataFn.bind(this,this)}));}}]);return Home;}(React.Component);export{Home as default};","map":{"version":3,"sources":["D:/myCompany/zhongdianqiche/a/src/views/TabOne/Home/index.js"],"names":["React","DownloadApp","axios","styles","Home","props","handle","type","id","history","push","bindHandleScroll","winHeight","Math","ceil","window","scrollY","innerHeight","document","body","scrollHeight","state","list","page","isLoadingMore","getHomeList","wrapper","refs","loadMoreDataFn","that","timeCount","callback","top","getBoundingClientRect","windowHeight","screen","height","addEventListener","clearTimeout","setTimeout","setState","post","pageNo","pageSize","res","data","paddingTop","paddingBottom","inforList","map","item","backgroundColor","inforList_item","borderRadius","overflow","object","coverPic","title","minHeight","user","width","marginRight","key","headPic","fontSize","display","name","verticalAlign","require","loadMore","bind","Component"],"mappings":"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","sourcesContent":["import React from 'react'\r\n// 组件\r\nimport DownloadApp from '../../../components/DownloadApp'\r\n// axios\r\nimport axios from '../../../untils/axios'\r\nimport styles from './index.module.css'\r\n\r\nexport default class Home extends React.Component {\r\n  constructor (props) {\r\n    super(props)\r\n    this.state = {\r\n      list: [],\r\n      page: 0,\r\n      isLoadingMore: false\r\n    }\r\n  }\r\n  componentDidMount () {\r\n    // 获取首页列表数据\r\n    this.getHomeList()\r\n    // 监听滚动事件\r\n    const wrapper = this.refs.wrapper\r\n    const loadMoreDataFn = this.loadMoreDataFn\r\n    const that = this\r\n    let timeCount\r\n    function callback () {\r\n      const top = wrapper.getBoundingClientRect().top // 加载更多距离顶部的距离\r\n      const windowHeight = window.screen.height // 屏幕可视区域的高度\r\n      if (top && top < windowHeight) {\r\n        // 当 wrapper 已经被滚动到页面可视范围之内触发\r\n        loadMoreDataFn(that)\r\n      } \r\n    }\r\n    window.addEventListener('scroll', () => {\r\n      if (this.state.isLoadingMore) return\r\n      if (timeCount) {\r\n        clearTimeout(timeCount)\r\n      }\r\n      timeCount = setTimeout(callback, 500)\r\n    }, false)\r\n  }\r\n  // 加载更多事件\r\n  async loadMoreDataFn (that) {\r\n    await that.setState({ page: that.state.page + 1 })\r\n    const { data: res } = await axios.post('/keyN/home', {\r\n      pageNo: that.state.page,\r\n      pageSize: 14\r\n    })\r\n    that.setState({ list: [...that.state.list,...res] })\r\n  }\r\n  // 获取列表数据\r\n  async getHomeList () {\r\n    const { data: res } = await axios.post('/keyN/home', {\r\n      pageNo: this.state.page,\r\n      pageSize: 14\r\n    })\r\n    this.setState({ list: res })\r\n  }\r\n  // 跳转\r\n  handle = (type, id) => {\r\n    if (type === '重点号资讯') {\r\n      this.props.history.push(`/infor_details?id=${id}`)\r\n    } else {\r\n      this.props.history.push(`/video_details?id=${id}`)\r\n    }\r\n  }\r\n  // 监听滚动事件\r\n  bindHandleScroll =() => {\r\n    let winHeight = Math.ceil(window.scrollY + window.innerHeight)\r\n    return winHeight >= document.body.scrollHeight - 50 // 距离底部为50时候发送请求\r\n  }\r\n  render () {\r\n    return (\r\n      <div style={{paddingTop: '70px', paddingBottom: '50px'}}>\r\n        {/* 下载APP */}\r\n        <DownloadApp></DownloadApp>\r\n        {/* 首页列表 */}\r\n        <ul className={styles.inforList}>\r\n          {\r\n            this.state.list.map(item => {\r\n              return <li style={{backgroundColor: '#fff'}} onClick={() => {this.handle(item.type,item.id)}} className={styles.inforList_item} key={item.id}>\r\n                <div style={{borderRadius: '5px 5px 0 0', overflow: 'hidden'}}><img alt=\"\" style={{height: '100%'}} src={item.object.coverPic}></img></div>\r\n                <h3 className={styles.title} style={{minHeight: '48.8px', overflow: 'hidden'}}>{item.object.title}</h3>\r\n                <div className={styles.user}>\r\n                  <img style={{width: '25px', height: '25px', marginRight: '10px', borderRadius: '50%'}} alt=\"\" src={item.key.headPic}></img>\r\n                  <span style={{fontSize: '12px', display: 'inlineBlock', width: '80px'}}>{item.key.name}</span>\r\n                  <img alt=\"\" style={{width: '15px', height: '15px', verticalAlign: 'top'}} src={require('../../../assets/home/dianzan@2x.png')} />\r\n                </div>\r\n              </li>\r\n            })\r\n          }\r\n        </ul>\r\n        <div\r\n          className={styles.loadMore}\r\n          ref=\"wrapper\"\r\n          onClick={this.loadMoreDataFn.bind(this, this)}\r\n        >\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}