{"ast":null,"code":"import\"antd-mobile/lib/list/style/css\";import _List from\"antd-mobile/lib/list\";import\"antd-mobile/lib/button/style/css\";import _Button from\"antd-mobile/lib/button\";import\"antd-mobile/lib/input-item/style/css\";import _InputItem from\"antd-mobile/lib/input-item\";import _objectSpread from\"D:\\\\myCompany\\\\zhongdianqiche\\\\mobile\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import\"antd-mobile/lib/toast/style/css\";import _Toast from\"antd-mobile/lib/toast\";import _regeneratorRuntime from\"D:\\\\myCompany\\\\zhongdianqiche\\\\mobile\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\myCompany\\\\zhongdianqiche\\\\mobile\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\myCompany\\\\zhongdianqiche\\\\mobile\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import styles from'./index.module.css';import url from'url';import axios from'../../../untils/axios';import{wexinPay}from'../../../untils/wx';// 手机号正则\nvar ISMOBILE=/^[1][3,4,5,7,8,9][0-9]{9}$/;var Gathering=function Gathering(props){// 页面数据\nvar _useState=useState({}),_useState2=_slicedToArray(_useState,2),obj=_useState2[0],setObj=_useState2[1];// 用户报名信息\nvar _useState3=useState({name:'',phone:'',code:'',id:url.parse(props.location.search,true).query.id}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];// 获取页面信息\nuseEffect(function(){// 获取数据\nvar getLists=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$post,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.post('/gather/getGather',{id:user.id});case 2:_yield$axios$post=_context.sent;res=_yield$axios$post.data;setObj(res);case 5:case\"end\":return _context.stop();}}},_callee);}));return function getLists(){return _ref.apply(this,arguments);};}();getLists();},[]);// 获取验证码\nvar code=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(ISMOBILE.test(user.phone)){_context2.next=2;break;}return _context2.abrupt(\"return\",_Toast.fail('请输入正确的手机号',2));case 2:_context2.next=4;return axios.post('/user/sendCode',user);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function code(){return _ref2.apply(this,arguments);};}();// 报名参与\nvar submit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var _yield$axios$post2,rew;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!(!ISMOBILE.test(user.phone)||!user.name||!/^\\d{4}$/.test(user.code))){_context4.next=2;break;}return _context4.abrupt(\"return\",_Toast.fail('请将信息填写完整',2));case 2:_context4.next=4;return axios.post('/user/yzCode',user);case 4:_yield$axios$post2=_context4.sent;rew=_yield$axios$post2.data;if(rew){_context4.next=8;break;}return _context4.abrupt(\"return\",_Toast.fail('手机验证码错误',2));case 8:// 微信登录验证\nlocalStorage.setItem('user',JSON.stringify(user));window.location.href='https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx24ef6027f6157468&redirect_uri=https://www.zhongdianqiche.com/mobile/%23/pay&response_type=code&scope=snsapi_base&state=128#wechat_redirect';setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var code,_yield$axios$post3,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:// 提交数据\nsetUser(JSON.parse(localStorage.getItem('user')));code=window.location.href;_context3.next=4;return axios.post('/gather/addSign',_objectSpread(_objectSpread({},user),{},{gatherId:user.id,code:code}));case 4:_yield$axios$post3=_context3.sent;res=_yield$axios$post3.data;if(res){_context3.next=8;break;}return _context3.abrupt(\"return\",_Toast.fail('报名失败',2));case 8:wexinPay({appId:res.appId,nonceStr:res.nonceStr,package:res.package,paySign:res.paySign,signType:res.signType,timeStamp:res.timeStamp},function(){_Toast.fail('支付成功',2);});setUser({name:'',phone:'',code:'',id:''});case 10:case\"end\":return _context3.stop();}}},_callee3);})),1000);case 11:case\"end\":return _context4.stop();}}},_callee4);}));return function submit(){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"img\",{style:{width:'100%'},src:obj.coverPic,alt:\"\\u91CD\\u70B9\\u6C7D\\u8F66\"}),/*#__PURE__*/React.createElement(\"div\",{className:styles.title},/*#__PURE__*/React.createElement(\"img\",{src:obj.logo,alt:\"\\u91CD\\u70B9\\u6C7D\\u8F66\",style:{width:'100px',height:'100px'}}),/*#__PURE__*/React.createElement(\"h2\",null,obj.name)),/*#__PURE__*/React.createElement(\"div\",{className:styles.main},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h3\",null,\"\\u8BDA\\u610F\\u91D1: \",/*#__PURE__*/React.createElement(\"span\",null,obj.price,\"\\u5143\")),/*#__PURE__*/React.createElement(\"h3\",null,\"\\u6D3B\\u52A8\\u5956\\u54C1: \",/*#__PURE__*/React.createElement(\"span\",null,obj.gift))),/*#__PURE__*/React.createElement(\"ul\",null,obj.ensureList?obj.ensureList.map(function(item){return/*#__PURE__*/React.createElement(\"li\",{key:item},item);}):'')),/*#__PURE__*/React.createElement(\"div\",{className:styles.details},/*#__PURE__*/React.createElement(\"h3\",null,\"\\u6D3B\\u52A8\\u8BE6\\u60C5\"),/*#__PURE__*/React.createElement(\"div\",{dangerouslySetInnerHTML:{__html:obj.details}})),/*#__PURE__*/React.createElement(\"div\",{style:{backgroundColor:'#fff',marginTop:'15px'},className:styles.signUp},/*#__PURE__*/React.createElement(\"h3\",null,\"\\u6D3B\\u52A8\\u62A5\\u540D(\\u9700\\u652F\\u4ED8\\u8BDA\\u610F\\u91D1\",/*#__PURE__*/React.createElement(\"span\",null,\"\\uFFE5\",obj.price),\"\\u5143)\"),/*#__PURE__*/React.createElement(\"div\",{className:styles.item},/*#__PURE__*/React.createElement(\"span\",null,\"\\u6D3B\\u52A84S\\u5E97\\uFF1A\"),/*#__PURE__*/React.createElement(\"i\",null,obj.dealer?obj.dealer['name4s']:'')),/*#__PURE__*/React.createElement(\"div\",{className:styles.item},/*#__PURE__*/React.createElement(\"span\",null,\"\\u6D3B\\u52A8\\u5F00\\u59CB\\u65F6\\u95F4\\uFF1A\"),/*#__PURE__*/React.createElement(\"i\",null,obj.startDate)),/*#__PURE__*/React.createElement(\"div\",{className:styles.item},/*#__PURE__*/React.createElement(\"span\",null,\"\\u6D3B\\u52A8\\u7ED3\\u675F\\u65F6\\u95F4\\uFF1A\"),/*#__PURE__*/React.createElement(\"i\",null,obj.endDate)),/*#__PURE__*/React.createElement(_List,{className:styles.form},/*#__PURE__*/React.createElement(_InputItem,{placeholder:\"\\u8BF7\\u8F93\\u5165\\u60A8\\u7684\\u59D3\\u540D\",value:user.name,onChange:function onChange(v){return setUser(_objectSpread(_objectSpread({},user),{},{name:v}));}},\"\\u59D3\\u540D\"),/*#__PURE__*/React.createElement(_InputItem,{placeholder:\"\\u8BF7\\u8F93\\u5165\\u624B\\u673A\\u53F7\",value:user.phone,onChange:function onChange(v){return setUser(_objectSpread(_objectSpread({},user),{},{phone:v}));}},\"\\u624B\\u673A\\u53F7\\u7801\"),/*#__PURE__*/React.createElement(_InputItem,{placeholder:\"\\u8BF7\\u8F93\\u5165\\u9A8C\\u8BC1\\u7801\",value:user.code,onChange:function onChange(v){return setUser(_objectSpread(_objectSpread({},user),{},{code:v}));}},\"\\u9A8C\\u8BC1\\u7801\"),/*#__PURE__*/React.createElement(\"div\",{className:styles.btn},/*#__PURE__*/React.createElement(_Button,{size:\"small\",style:{width:'150px'},type:\"primary\",onClick:code},\"\\u83B7\\u53D6\\u9A8C\\u8BC1\\u7801\"),/*#__PURE__*/React.createElement(_Button,{size:\"small\",style:{width:'150px'},type:\"warning\",onClick:submit},\"\\u7ACB\\u5373\\u62A5\\u540D\")))),/*#__PURE__*/React.createElement(\"div\",{className:styles.process},/*#__PURE__*/React.createElement(\"h3\",{style:{padding:'10px'}},\"\\u6D3B\\u52A8\\u6D41\\u7A0B\"),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"img\",{style:{width:'100%'},src:require('../../../assets/activity/1.png'),alt:\"\\u91CD\\u70B9\\u6C7D\\u8F66\"})),/*#__PURE__*/React.createElement(\"div\",{className:styles.top},/*#__PURE__*/React.createElement(\"div\",null,\"\\u8054\\u7CFB\\u7535\\u8BDD: \",obj.phone),/*#__PURE__*/React.createElement(\"div\",null,\"\\u6D3B\\u52A84S\\u5E97: \",obj.dealer?obj.dealer['name4s']:'')),/*#__PURE__*/React.createElement(\"div\",{className:styles.bottom},\"\\u672C\\u6D3B\\u52A8\\u6709\\u7ECF\\u9500\\u5546\\u7EC4\\u7EC7\\u5E76\\u8D1F\\u8D23\\uFF0C\\u6D3B\\u52A8\\u8BE6\\u7EC6\\u8BF7\\u54A8\\u8BE2\\u7ECF\\u9500\\u5546\\uFF0C\\u91CD\\u70B9\\u6C7D\\u8F66\\u7F51\\u4EC5\\u63D0\\u4F9B\\u6280\\u672F\\u652F\\u6301\")));};export default Gathering;","map":{"version":3,"sources":["D:/myCompany/zhongdianqiche/mobile/src/views/Activity/Gathering/index.js"],"names":["React","useState","useEffect","styles","url","axios","wexinPay","ISMOBILE","Gathering","props","obj","setObj","name","phone","code","id","parse","location","search","query","user","setUser","getLists","post","res","data","test","fail","submit","rew","localStorage","setItem","JSON","stringify","window","href","setTimeout","getItem","gatherId","appId","nonceStr","package","paySign","signType","timeStamp","width","coverPic","title","logo","height","main","price","gift","ensureList","map","item","details","__html","backgroundColor","marginTop","signUp","dealer","startDate","endDate","form","v","btn","process","padding","require","top","bottom"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\r\nimport { InputItem, List, Button, Toast } from 'antd-mobile'\r\nimport styles from './index.module.css'\r\nimport url from 'url'\r\nimport axios from '../../../untils/axios'\r\nimport { wexinPay } from '../../../untils/wx'\r\n\r\n// 手机号正则\r\nconst ISMOBILE = /^[1][3,4,5,7,8,9][0-9]{9}$/\r\n\r\nconst Gathering = (props) => {\r\n  // 页面数据\r\n  const [obj, setObj] = useState({})\r\n  // 用户报名信息\r\n  const [user, setUser] = useState({name: '', phone: '', code: '', id: url.parse(props.location.search, true).query.id})\r\n  // 获取页面信息\r\n  useEffect(() => {\r\n    // 获取数据\r\n    const getLists = async () => {\r\n      // 授权登录\r\n      const { data: res } = await axios.post('/gather/getGather', { id: user.id })\r\n      setObj(res)\r\n    }\r\n    getLists()\r\n  }, [])\r\n\r\n  // 获取验证码\r\n  const code = async () => {\r\n    if (!ISMOBILE.test(user.phone)) return Toast.fail('请输入正确的手机号', 2)\r\n    await axios.post('/user/sendCode', user)\r\n  }\r\n  // 报名参与\r\n  const submit = async () => {\r\n    if (!ISMOBILE.test(user.phone) || !user.name || !(/^\\d{4}$/.test(user.code))) return Toast.fail('请将信息填写完整', 2)\r\n    // 短信验证\r\n    const { data: rew } = await axios.post('/user/yzCode', user)\r\n    if (!rew) return Toast.fail('手机验证码错误', 2)\r\n    // 微信登录验证\r\n    localStorage.setItem('user', JSON.stringify(user))\r\n    window.location.href = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx24ef6027f6157468&redirect_uri=https://www.zhongdianqiche.com/mobile/%23/pay&response_type=code&scope=snsapi_base&state=128#wechat_redirect'\r\n    setTimeout(async () => {\r\n      // 提交数据\r\n      setUser(JSON.parse(localStorage.getItem('user')))\r\n      const code = window.location.href\r\n      const { data: res } = await axios.post('/gather/addSign', {...user, gatherId: user.id, code: code})\r\n      if (!res) return Toast.fail('报名失败', 2)\r\n      wexinPay(\r\n        {\r\n          appId: res.appId,\r\n          nonceStr: res.nonceStr,\r\n          package: res.package,\r\n          paySign: res.paySign,\r\n          signType: res.signType,\r\n          timeStamp: res.timeStamp\r\n        },\r\n        () => {\r\n          Toast.fail('支付成功', 2)\r\n        }\r\n      )\r\n      setUser({name: '', phone: '', code: '', id: ''})\r\n    }, 1000)\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      {/* 封面图 */}\r\n      <img style={{width: '100%'}} src={obj.coverPic} alt=\"重点汽车\"></img>\r\n      {/* 活动标题 */}\r\n      <div className={styles.title}>\r\n        <img src={obj.logo} alt=\"重点汽车\" style={{width: '100px', height: '100px'}} />\r\n        <h2>{obj.name}</h2>\r\n      </div>\r\n      <div className={styles.main}>\r\n        {/* 活动金额和礼品 */}\r\n        <div>\r\n          <h3>诚意金: <span>{obj.price}元</span></h3>\r\n          <h3>活动奖品: <span>{obj.gift}</span></h3>\r\n        </div>\r\n        {/* 活动保障 */}\r\n        <ul>\r\n          {\r\n            obj.ensureList ? obj.ensureList.map(item => {\r\n              return <li key={item}>{item}</li>\r\n            }): ''\r\n          }\r\n        </ul>\r\n      </div>\r\n      {/* 活动详情 */}\r\n      <div className={styles.details}>\r\n        <h3>活动详情</h3>\r\n        <div dangerouslySetInnerHTML={{__html: obj.details}}></div>\r\n      </div>\r\n      {/* 活动报名 */}\r\n      <div style={{backgroundColor: '#fff', marginTop: '15px'}} className={styles.signUp}>\r\n        <h3>活动报名(需支付诚意金<span>￥{obj.price}</span>元)</h3>\r\n        <div className={styles.item}>\r\n          <span>活动4S店：</span>\r\n          <i>{obj.dealer ? obj.dealer['name4s'] : ''}</i>\r\n        </div>\r\n        <div className={styles.item}>\r\n          <span>活动开始时间：</span>\r\n          <i>{obj.startDate}</i>\r\n        </div>\r\n        <div className={styles.item}>\r\n          <span>活动结束时间：</span>\r\n          <i>{obj.endDate}</i>\r\n        </div>\r\n        <List className={styles.form}>\r\n          <InputItem placeholder=\"请输入您的姓名\" value={user.name} onChange={v => setUser({...user, name: v})}>姓名</InputItem>\r\n          <InputItem placeholder=\"请输入手机号\" value={user.phone} onChange={v => setUser({...user, phone: v})}>手机号码</InputItem>\r\n          <InputItem placeholder=\"请输入验证码\" value={user.code} onChange={v => setUser({...user, code: v})}>验证码</InputItem>\r\n          <div className={styles.btn}>\r\n            <Button size=\"small\" style={{width: '150px'}} type=\"primary\" onClick={code}>获取验证码</Button>\r\n            <Button size=\"small\" style={{width: '150px'}} type=\"warning\" onClick={submit}>立即报名</Button>\r\n          </div>\r\n        </List>\r\n      </div>\r\n      {/* 活动流程 */}\r\n      <div className={styles.process}>\r\n        <h3 style={{padding: '10px'}}>活动流程</h3>\r\n        <div>\r\n          <img style={{width: '100%'}} src={require('../../../assets/activity/1.png')} alt=\"重点汽车\" />\r\n        </div>\r\n        <div className={styles.top}>\r\n          <div>联系电话: {obj.phone}</div>\r\n          <div>活动4S店: {obj.dealer ? obj.dealer['name4s'] : ''}</div>\r\n        </div>\r\n        <div className={styles.bottom}>\r\n          本活动有经销商组织并负责，活动详细请咨询经销商，重点汽车网仅提供技术支持\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Gathering"]},"metadata":{},"sourceType":"module"}