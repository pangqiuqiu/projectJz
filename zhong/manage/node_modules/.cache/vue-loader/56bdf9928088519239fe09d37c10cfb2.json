{"remainingRequest":"D:\\myCompany\\project\\aaa\\new\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\myCompany\\project\\aaa\\new\\src\\views\\adv\\Edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\myCompany\\project\\aaa\\new\\src\\views\\adv\\Edit.vue","mtime":1587027509021},{"path":"D:\\myCompany\\project\\aaa\\new\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\myCompany\\project\\aaa\\new\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\myCompany\\project\\aaa\\new\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\myCompany\\project\\aaa\\new\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpleHBvcnQgZGVmYXVsdCB7DQogIGRhdGEgKCkgew0KICAgIHJldHVybiB7DQogICAgICAvLyDlub/lkYrkv6Hmga8NCiAgICAgIGFkdk9iajoge30sDQogICAgICAvLyDmj5DkuqTlkI7lj7ANCiAgICAgIGZvcm06IHsNCiAgICAgICAgdXJsOiAnJywNCiAgICAgICAgcGljOiAnJywNCiAgICAgICAgaWQ6ICcnLA0KICAgICAgICB0aXRsZTogJycNCiAgICAgIH0NCiAgICB9DQogIH0sDQogIGNyZWF0ZWQgKCkgew0KICAgIC8vIOiOt+WPluW5v+WRiuS/oeaBrw0KICAgIHRoaXMuZ2V0QWR2KCkNCiAgICAvLyDojrflj5blm77niYfkv6Hmga8NCiAgICB0aGlzLmdldFBpYygpDQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICAvLyDojrflj5blub/lkYrkv6Hmga8NCiAgICBnZXRBZHYgKCkgew0KICAgICAgY29uc3Qgcm93ID0gSlNPTi5wYXJzZSh0aGlzLiRyb3V0ZS5xdWVyeS5yb3cpDQogICAgICB0aGlzLmFkdk9iaiA9IHJvdw0KICAgICAgdGhpcy5mb3JtLmlkID0gdGhpcy5hZHZPYmouaWQNCiAgICB9LA0KICAgIC8vIOWbvueJh+S/oeaBrw0KICAgIGFzeW5jIGdldFBpYyAoKSB7DQogICAgICBjb25zdCByb3cgPSBKU09OLnBhcnNlKHRoaXMuJHJvdXRlLnF1ZXJ5LnJvdykNCiAgICAgIGNvbnN0IHsgZGF0YTogcmVzIH0gPSBhd2FpdCB0aGlzLiRodHRwLnBvc3QoJy9hZHYvZ2V0QWR2Jywgew0KICAgICAgICBpZDogcm93LmlkDQogICAgICB9KQ0KICAgICAgdGhpcy5mb3JtLnBpYyA9IHJlcy5waWMNCiAgICAgIHRoaXMuZm9ybS51cmwgPSByZXMudXJsDQogICAgICB0aGlzLmZvcm0udGl0bGUgPSByZXMudGl0bGUNCiAgICB9LA0KICAgIC8vIOWIoOmZpOW5v+WRiuWGheWuuQ0KICAgIGFzeW5jIGRlbGV0ZWQgKCkgew0KICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy4kaHR0cC5wb3N0KCcvYWR2L3VwZGF0ZUFkdicsIHsNCiAgICAgICAgaWQ6IHRoaXMuZm9ybS5pZA0KICAgICAgfSkNCiAgICAgIGlmIChyZXMuc3RhdHVzICE9PSAyMDAgfHwgcmVzLmRhdGEgIT09IHRydWUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+WIoOmZpOWksei0pScpDQogICAgICB9DQogICAgICB0aGlzLiRyb3V0ZXIuZ28oMCkNCiAgICB9LA0KICAgIC8vIOaPkOS6pOaWsOW5v+WRig0KICAgIHVwZGF0YSAoKSB7DQogICAgICBpZiAodGhpcy5mb3JtLnVybCA9PT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign6K+35aGr5YaZ5bm/5ZGK5aSW6ZO+JykNCiAgICAgIH0NCiAgICAgIGlmICh0aGlzLiRyZWZzLm5ld19pbWFnZS5maWxlc1swXSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCfor7fkuIrkvKDlub/lkYrlhoXlrrnlm77niYcnKQ0KICAgICAgfQ0KICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKQ0KICAgICAgZm9ybURhdGEuYXBwZW5kKCdpbWFnZV9kYXRhJywgdGhpcy4kcmVmcy5uZXdfaW1hZ2UuZmlsZXNbMF0pDQogICAgICB0aGlzLiRodHRwLnBvc3QoJy91cGxvYWQvdXBsb2FkMicsIGZvcm1EYXRhLCB7DQogICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ211bHRpcGFydC9mb3JtLWRhdGEnDQogICAgICAgIH0NCiAgICAgIH0pLnRoZW4ocmVzID0+IHsNCiAgICAgICAgaWYgKHJlcy5kYXRhID09PSAn5Zu+54mH5LiK5Lyg5aSx6LSl77yBJykgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+W5v+WRiuS4iuS8oOWksei0pScpDQogICAgICAgIHRoaXMuZm9ybS5waWMgPSByZXMuZGF0YQ0KICAgICAgICB0aGlzLiRodHRwLnBvc3QoJy9hZHYvdXBkYXRlQWR2JywgdGhpcy5mb3JtKS50aGVuKHJldyA9PiB7DQogICAgICAgICAgaWYgKHJldy5zdGF0dXMgIT09IDIwMCB8fCByZXcuZGF0YSAhPT0gdHJ1ZSkgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+S/ruaUueWksei0pScpDQogICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9hZHYvaG9tZScpDQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCfkv67mlLnmiJDlip8nKQ0KICAgICAgICB9KS5jYXRjaChyZXcgPT4gew0KICAgICAgICAgIGNvbnNvbGUubG9nKHJldykNCiAgICAgICAgfSkNCiAgICAgIH0pLmNhdGNoKHJlcyA9PiB7DQogICAgICAgIGNvbnNvbGUubG9nKHJlcykNCiAgICAgIH0pDQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["Edit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Edit.vue","sourceRoot":"src/views/adv","sourcesContent":["<template>\r\n  <div>\r\n    <!-- 广告位置 -->\r\n    <h2>{{this.advObj.name}}</h2>\r\n    <!-- 广告尺寸 -->\r\n    <el-row :gutter=\"20\">\r\n      <el-col :span=\"3\">尺寸大小</el-col>\r\n      <el-col :span=\"21\">{{this.advObj.size}}</el-col>\r\n    </el-row>\r\n    <!-- 广告标题 -->\r\n    <el-row :gutter=\"20\">\r\n      <el-col :span=\"3\">广告标题</el-col>\r\n      <el-col :span=\"21\">\r\n        <el-input v-model=\"form.title\" style=\"width: 400px\" placeholder=\"请输入广告标题\"></el-input>\r\n      </el-col>\r\n    </el-row>\r\n    <!-- 广告链接 -->\r\n    <el-row :gutter=\"20\">\r\n      <el-col :span=\"3\">广告链接</el-col>\r\n      <el-col :span=\"21\">\r\n        <el-input v-model=\"form.url\" style=\"width: 400px\" placeholder=\"请输入广告链接内容\"></el-input>\r\n      </el-col>\r\n    </el-row>\r\n    <!-- 修改内容 -->\r\n    <el-row :gutter=\"20\">\r\n      <el-col :span=\"3\">修改广告内容</el-col>\r\n      <el-col :span=\"21\">\r\n        <input type=\"file\" id=\"saveImage\" name=\"myphoto\" accept=\"image/png,image/gif,image/jpeg\" ref=\"new_image\">\r\n      </el-col>\r\n    </el-row>\r\n    <!-- 广告内容 -->\r\n    <el-row :gutter=\"20\">\r\n      <el-col :span=\"24\">\r\n        <img :src=\"form.pic\" alt=\"\">\r\n      </el-col>\r\n    </el-row>\r\n    <!-- 提交 -->\r\n    <el-row :gutter=\"20\">\r\n      <el-col :span=\"24\">\r\n        <el-button type=\"success\" @click=\"updata\">提交新广告</el-button>\r\n        <el-button type=\"danger\" @click=\"deleted\">删除广告内容</el-button>\r\n      </el-col>\r\n    </el-row>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data () {\r\n    return {\r\n      // 广告信息\r\n      advObj: {},\r\n      // 提交后台\r\n      form: {\r\n        url: '',\r\n        pic: '',\r\n        id: '',\r\n        title: ''\r\n      }\r\n    }\r\n  },\r\n  created () {\r\n    // 获取广告信息\r\n    this.getAdv()\r\n    // 获取图片信息\r\n    this.getPic()\r\n  },\r\n  methods: {\r\n    // 获取广告信息\r\n    getAdv () {\r\n      const row = JSON.parse(this.$route.query.row)\r\n      this.advObj = row\r\n      this.form.id = this.advObj.id\r\n    },\r\n    // 图片信息\r\n    async getPic () {\r\n      const row = JSON.parse(this.$route.query.row)\r\n      const { data: res } = await this.$http.post('/adv/getAdv', {\r\n        id: row.id\r\n      })\r\n      this.form.pic = res.pic\r\n      this.form.url = res.url\r\n      this.form.title = res.title\r\n    },\r\n    // 删除广告内容\r\n    async deleted () {\r\n      const res = await this.$http.post('/adv/updateAdv', {\r\n        id: this.form.id\r\n      })\r\n      if (res.status !== 200 || res.data !== true) {\r\n        return this.$message.error('删除失败')\r\n      }\r\n      this.$router.go(0)\r\n    },\r\n    // 提交新广告\r\n    updata () {\r\n      if (this.form.url === null) {\r\n        return this.$message.error('请填写广告外链')\r\n      }\r\n      if (this.$refs.new_image.files[0] === undefined) {\r\n        return this.$message.error('请上传广告内容图片')\r\n      }\r\n      const formData = new FormData()\r\n      formData.append('image_data', this.$refs.new_image.files[0])\r\n      this.$http.post('/upload/upload2', formData, {\r\n        headers: {\r\n          'Content-Type': 'multipart/form-data'\r\n        }\r\n      }).then(res => {\r\n        if (res.data === '图片上传失败！') return this.$message.error('广告上传失败')\r\n        this.form.pic = res.data\r\n        this.$http.post('/adv/updateAdv', this.form).then(rew => {\r\n          if (rew.status !== 200 || rew.data !== true) return this.$message.error('修改失败')\r\n          this.$router.push('/adv/home')\r\n          this.$message.success('修改成功')\r\n        }).catch(rew => {\r\n          console.log(rew)\r\n        })\r\n      }).catch(res => {\r\n        console.log(res)\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\nh2 {\r\n  text-align: center;\r\n  margin-bottom: 30px;\r\n}\r\n.el-row {\r\n  margin-bottom: 30px;\r\n}\r\n</style>\r\n"]}]}